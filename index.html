<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTFM</title>
    
    <link rel="stylesheet" type="text/css" href="http://documentup.com/stylesheets/screen.css">
    
    

    
  </head>
  <body><div id="nav">
  
    <div id="header">
      <a href="#" id="logo">RTFM</a>
    </div>
  
  <ul id="sections">
    
      <li>
        <a href="#overview">Overview</a>
        
          <ul>
            
              <li>
                <a href="#overview/authentication">Authentication</a>
              </li>
            
              <li>
                <a href="#overview/testing">Testing</a>
              </li>
            
              <li>
                <a href="#overview/errors">Errors</a>
              </li>
            
              <li>
                <a href="#overview/rate-limit">Rate limit</a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="#images">Images</a>
        
          <ul>
            
              <li>
                <a href="#images/posting">Posting</a>
              </li>
            
              <li>
                <a href="#images/retrieving">Retrieving</a>
              </li>
            
              <li>
                <a href="#images/webhook">Webhook</a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="#api-libraries">API Libraries</a>
        
          <ul>
            
              <li>
                <a href="#api-libraries/ruby">Ruby</a>
              </li>
            
              <li>
                <a href="#api-libraries/other">Other</a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="#moderation">Moderation</a>
        
      </li>
    
      <li>
        <a href="#contact">Contact</a>
        
      </li>
    
  </ul>
  
  
</div>
<div id="content">
  
  <h1>Real Time Foto Moderator</h1>
<p><a href="http://crowdflower.com/rtfm">RTFM</a> is a <a href="http://crowdflower.com">human-powered</a>
image moderation API.

</p>
<h2 id='overview'>Overview</h2 id='overview'>
<p>RTFM provides a <a href="http://en.wikipedia.org/wiki/Representational_state_transfer">RESTful</a>
API that is designed to have resource-oriented URLs, use HTTP response codes to
indicate errors and use built-in HTTP features like HTTP authentication. All
responses will be returned in JSON.

</p>
<p>The API endpoint is <code>https://rtfm.crowdflower.com/v1/</code>. All API requests must
be made over HTTPS. Requests made over plain HTTP will fail. Authentication is
required for all requests.

</p>
<h3 id='overview/authentication'>Authentication</h3 id='overview/authentication'>
<p>Authentication to the API occurs via <a href="http://en.wikipedia.org/wiki/Basic_access_authentication">HTTP Basic Auth</a>.
Pass your API key as the basic auth username. You do not need to provide a
password.

</p>
<p>API keys are managed in your account settings.

</p>
<pre><code class="shell"><span class="preprocessor"># curl uses the -u flag to pass basic auth credentials. Adding a colon after your</span>
<span class="preprocessor"># API key will prevent curl from asking you for a password.</span>

curl https:<span class="comment">//rtfm.crowdflower.com/v1/images \</span>
  -u <span class="number">7</span>xgUnFVvHSsotiS6zaX2Nw1gcqwnBH0: \
  -d <span class="string">"url=http://example.com/test.jpg"</span></code></pre>
<h3 id='overview/testing'>Testing</h3 id='overview/testing'>
<p>RTFM provides a developer authentication key for testing. You can find this
key in your <em>Developer</em> subscription settings. All documented API calls work 
with your developer key. 

</p>
<p>Images posted using this key are not sent to moderators in the crowdâ€”they&#39;re
moderated based on substrings in the posted <em>url</em> parameter:

</p>
<pre><code class="ascii"><span class="localvars">| substring |</span> url                             <span class="localvars">| moderation result                    |</span>
|-----------+---------------------------------+--------------------------------------|
<span class="localvars">| approved  |</span> <span class="method">http:</span>//example.com/approved.jpg | { <span class="comment">"score"</span>: <span class="number">1.0</span>, <span class="comment">"rating"</span>: approved } |
<span class="localvars">| rejected  |</span> <span class="method">http:</span>//example.com/rejected.jpg | { <span class="comment">"score"</span>: <span class="number">0.1</span>, <span class="comment">"rating"</span>: rejected } |
<span class="localvars">| neither   |</span> <span class="method">http:</span>//example.com/neither.jpg  | random result, either of the above   |</code></pre>
<p>The substring can be anywhere in your domain, filename or query string.
A webhook will be posted to your webhook URL within several minutes.

</p>
<h3 id='overview/errors'>Errors</h3 id='overview/errors'>
<p>RTFM uses HTTP response codes to indicate success or failure of a request.
Codes in the 2xx range indicate success, codes in the 4xx range indicate an
error and codes in the 5xx range indicate an error with RTFM&#39;s servers.

</p>
<ul>
<li><strong>200</strong> OK - everything worked</li>
<li><strong>401</strong> Unauthorized - invalid API key provided</li>
<li><strong>402</strong> Payment required - insufficient funds on your account</li>
<li><strong>404</strong> Not found - the requested item doesn&#39;t exist</li>
<li><strong>422</strong> Unprocessable entity - invalid submitted data</li>
</ul>
<h3 id='overview/rate-limit'>Rate limit</h3 id='overview/rate-limit'>
<p>RTFM allows up to 10 requests per second from the same IP address. If you
exceed this limit, you&#39;ll get a <em>503 Service Unavailable</em> response for subsequent
requests.

</p>
<h2 id='images'>Images</h2 id='images'>
<p>Moderators screen images based on an extensive ruleset. See
<a href="#moderation">Moderation</a> for the list of criteria.

</p>
<h5><strong>Score</strong></h5>
<p>A confidence score, between 0 and 1, calculated from moderator responses.
0 is rejected, 1 is approved.

</p>
<h5><strong>Rating</strong></h5>
<ul>
<li><strong>rejected</strong>: score less than 0.5</li>
<li><strong>approved</strong>: score of 0.5 or greater</li>
</ul>
<h5><strong>States</strong></h5>
<ul>
<li><strong>processing</strong>: image is being moderated</li>
<li><strong>on hold</strong>: account has insufficient funds</li>
<li><strong>completed</strong>: image has completed moderation</li>
</ul>
<h3 id='images/posting'>Posting</h3 id='images/posting'>
<p>Image URLs must be publically accessible. A <a href="#images/webhook">webhook</a> is sent
when moderation for an image is completed.

</p>
<p>An optional metadata hash parameter can be posted with your image. You can use
this parameter for arbitrary data, e.g. an internal primary key. We will return
this metadata with your image data when we send a webhook or if you make API
call, requesting that image.

</p>
<p><code>POST /images</code> uploads a image:

</p>
<pre><code class="shell"><span class="preprocessor"># paramters:</span>
<span class="preprocessor">#</span>
<span class="preprocessor"># "url": string</span>
<span class="preprocessor"># "metadata" (optional): hash</span>

curl https:<span class="comment">//rtfm.crowdflower.com/v1/images \</span>
  -u <span class="number">7</span>xgUnFVvHSsotiS6zaX2Nw1gcqwnBH0: \
  -d <span class="string">"url=http://example.com/test.jpg"</span> \
  -d <span class="string">"metadata[internal_id]=Aj39x"</span> \
  -d <span class="string">"metadata[internal_status]=spam"</span></code></pre>
<p>Response:
</p>
<pre><code class="json"><span class="preprocessor"># attributes:</span>
<span class="preprocessor">#</span>
<span class="preprocessor"># image: hash</span>
<span class="preprocessor">#   "id": string</span>
<span class="preprocessor">#   "url": string</span>
<span class="preprocessor">#   "metadata" (optional): hash</span>

{
  <span class="string">"image"</span>: {
    <span class="string">"id"</span>: {IMAGE_ID},
    <span class="string">"url"</span>: {IMAGE_URL},
    <span class="string">"metadata"</span>: {IMAGE_METADATA}
  }
}</code></pre>
<h3 id='images/retrieving'>Retrieving</h3 id='images/retrieving'>
<p><code>GET /images/{IMAGE_ID}</code> returns data about a posted image.

</p>
<pre><code class="shell">curl <span class="method">https:</span>//rtfm.crowdflower.com/v1/images/{<span class="class">IMAGE_ID</span>} \
  -u <span class="number">7</span><span class="method">xgUnFVvHSsotiS6zaX2Nw1gcqwnBH0:</span></code></pre>
<p>Response:
</p>
<pre><code class="json"><span class="preprocessor"># attributes:</span>
<span class="preprocessor">#</span>
<span class="preprocessor"># image: hash</span>
<span class="preprocessor">#   "id": string</span>
<span class="preprocessor">#   "url": string</span>
<span class="preprocessor">#   "score": integer</span>
<span class="preprocessor">#   "rating": string</span>
<span class="preprocessor">#   "state": string</span>
<span class="preprocessor">#   "metadata" (optional): hash</span>

{
  <span class="string">"image"</span>: {
    <span class="string">"id"</span>: {IMAGE_ID},
    <span class="string">"url"</span>: {IMAGE_URL},
    <span class="string">"score"</span>: {IMAGE_SCORE},
    <span class="string">"rating"</span>: {IMAGE_RATING},
    <span class="string">"state"</span>: {IMAGE_STATE},
    <span class="string">"metadata"</span>: {IMAGE_METADATA}
  }
}</code></pre>
<h3 id='images/webhook'>Webhook</h3 id='images/webhook'>
<p>We will POST moderation results to your webhook URL.
This URL is managed in your account settings.

</p>
<pre><code class="json"><span class="preprocessor"># attributes:</span>
<span class="preprocessor">#</span>
<span class="preprocessor"># image: hash</span>
<span class="preprocessor">#   "id": string</span>
<span class="preprocessor">#   "url": string</span>
<span class="preprocessor">#   "score": integer</span>
<span class="preprocessor">#   "rating": string</span>
<span class="preprocessor">#   "state": string</span>
<span class="preprocessor">#   "metadata" (optional): hash</span>

{
  <span class="string">"image"</span>: {
    <span class="string">"id"</span>: {IMAGE_ID},
    <span class="string">"url"</span>: {IMAGE_URL},
    <span class="string">"score"</span>: {IMAGE_SCORE},
    <span class="string">"rating"</span>: {IMAGE_RATING},
    <span class="string">"state"</span>: {IMAGE_STATE},
    <span class="string">"metadata"</span>: {IMAGE_METADATA}
  }
}</code></pre>
<h4>Failure</h4>
<p>RTFM expects a 2xx HTTP response code when posting webhooks to your server. Your
webhook will immediately be disabled if we receive a 3xx or 4xx response code.
RTFM will retry up to 10 times if your server returns a 5xx error. If there are
10 consecutive 5xx errors for a single image, we will disable the webhook and
notify you. All pending webhooks will be sent when you re-enable your webhook.

</p>
<h4>Signature</h4>
<p>All webhook POSTs include a &quot;X-CrowdFlower-Signature&quot; HTTP header. You can use
this signature to ensure that you only accept requests from our servers.

</p>
<p>The signature is composed of a Base64 encoded SHA1 digest of the JSON body and is
computed by signing the unescaped JSON body of the request with an RSA key.

</p>
<p>Use <a href="http://rtfm.crowdflower.com/webhook_public.pem">this public key</a> to verify
the signature.

</p>
<p>Shell:
</p>
<pre><code class="shell">echo -n <span class="string">"unescaped JSON body of webhook request"</span> > body<span class="preprocessor">.json</span>
echo <span class="string">"base64 encoded contents of X-CrowdFlower-Signature"</span> | openssl enc -base64 -d > sig<span class="preprocessor">.txt</span>
openssl dgst -sha1 -verify webhook_public<span class="preprocessor">.pem</span> -signature sig<span class="preprocessor">.txt</span> body<span class="preprocessor">.json</span></code></pre>
<p>Ruby:
</p>
<pre><code class="ruby"><span class="identifier">public_key</span> = <span class="constant">OpenSSL::PKey::RSA</span>.<span class="identifier"><span class="keymethods">new</span></span>(<span class="constant">File</span>.<span class="identifier"><span class="keymethods">read</span></span>(<span class="string">"webhook_public.pem"</span>))
<span class="identifier">digest</span> = <span class="constant">OpenSSL::Digest::SHA1</span>.<span class="identifier"><span class="keymethods">new</span></span>
<span class="identifier">public_key</span>.<span class="identifier">verify</span>(<span class="identifier">digest</span>, <span class="constant">Base64</span>.<span class="identifier">decode64</span>(<span class="identifier">signature</span>), <span class="identifier">unencoded_json_body</span>)</code></pre>
<p>PHP:
</p>
<pre><code class="php"><span class="variable">$fp</span> = fopen(<span class="string">"webhook_public.pem"</span>, <span class="string">"r"</span>);
<span class="variable">$cert</span> = fread(<span class="variable">$fp</span>, <span class="number">8192</span>);
fclose(<span class="variable">$fp</span>);
<span class="variable">$pubkeyid</span> = openssl_get_publickey(<span class="variable">$cert</span>);
openssl_verify(<span class="variable">$data</span>, <span class="variable">$signature</span>, <span class="variable">$pubkeyid</span>);
openssl_free_key(<span class="variable">$pubkeyid</span>);</code></pre>
<h2 id='api-libraries'>API Libraries</h2 id='api-libraries'>
<h3 id='api-libraries/ruby'>Ruby</h3 id='api-libraries/ruby'>
<p>CrowdFlower currently maintains a Ruby gem for interacting with the API.  The gem
can be found here: <a href="https://github.com/dolores/rtfm-ruby">https://github.com/dolores/rtfm-ruby</a>

</p>
<h3 id='api-libraries/other'>Other</h3 id='api-libraries/other'>
<p>If you&#39;ve created a simple wrapper for the RTFM API in another language, we would
be happy to host it on our Github account.  Let us know by emailing rtfm@crowdflower.com

</p>
<h2 id='moderation'>Moderation</h2 id='moderation'>
<p>Moderators follow extensive rules while screening images. These rules have been
effective in avoiding user complaints and problems with Apple&#39;s App Store
review process, specifically:

</p>
<p><strong>prohibited sexual material or nudity</strong>:

</p>
<ul>
<li>sexual acts, either real or illustrated</li>
<li>sexually explicit or overly suggestive photos</li>
<li>nudity (frontal, back or side)</li>
<li>nudity (particularly of the genitals) covered by a towel, hat or other means</li>
<li>grabbing, holding or touching genitals or genital area</li>
<li>transparent/sheer or wet material below the waist or covering women&#39;s nipples/breasts</li>
<li>erections or outline of genitals through clothing</li>
<li>bare skin one inch directly above the pubic area</li>
<li>shirtless body shots indoors. shirtless body shots are only allowed in natural settings (e.g. beach or swimming pool)</li>
<li>cleavage shots without a face</li>
<li>pubic hair</li>
<li>underwear, including underwear waistband showing above pants</li>
<li>body/torso shots without a head/face</li>
<li>crotch/butt/abs without a head/face</li>
<li>display of semen or any fluid made to look like semen or ejaculate</li>
<li>images edited to disguise sexual acts (e.g. black box or blurred filters)</li>
<li>sex props or toys, including the use of fruits/vegetables</li>
<li>any obscene gestures or lewd behavior (e.g. middle finger or banana used to simulate male genitalia)</li>
<li>hands or fingers placed in pants or pulling underwear outward</li>
</ul>
<p><strong>appropriate dress</strong>:

</p>
<ul>
<li>public swimwear is allowed if the following is observed: no pubic hair, no women&#39;s nipples, no outline of genitals and no portion of the butt can be present</li>
<li>swimwear photos are only allowed if they are in natural settings (e.g. beach or swimming pool)</li>
<li>pants and shorts must be worn normally, buttoned and not pulled or hanging down</li>
</ul>
<p><strong>prohibited ads or copyrighted material</strong>:

</p>
<ul>
<li>advertised services, goods, events, websites or apps</li>
<li>images or illustrations</li>
</ul>
<p><strong>prohibited violent or illegal material</strong>:

</p>
<ul>
<li>illegal drugs, drug use or paraphernalia</li>
<li>guns, firearms or weapons</li>
<li>violent acts to the user, someone else or animals (including blood)</li>
<li>profanity or curse words</li>
</ul>
<h2 id='contact'>Contact</h2 id='contact'>
<p>Report issues or suggest improvements on our
<a href="https://github.com/dolores/rtfm-api/issues">GitHub repository</a> or email us at rtfm@crowdflower.com.
</p>

</div></body>
</html>